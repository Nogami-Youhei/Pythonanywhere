{% extends 'pls/base.html' %}        
{% block title %}
<title>SHAP</title>
{% endblock %}
{% block main %}
{% load static %}
    <div class="wrapper">
        <h2 class="page-title">SHAP</h2>
        <hr>
    </div>
    </div>
    <div class="pcr-contents wrapper">
    <div class="excel_fig">
    <div>
    <p class="outline">ランダムフォレスト・線形回帰におけるSHAP値計算</p>
    <br>
    <p>※右の図のように縦はデータ、横は説明変数となるように、データ名も含めて説明変数と目的変数をそれぞれエクセルからコピーし、貼り付けてください。</p>
    <p>図は説明変数をコピーするときの例です。</p>
    <p>説明変数の数に制限はありません。</p>
    <p>結果の最下段のグラフはサンプル行番号で選択した1つのデータについて、説明変数の寄与率を表しています。</p>
    </div>
    <img src="/static/pls/img/excel_fig.png" alt="excel_fig">
    </div>
    <form action="{% url 'shap' %}" method="post" id="shap">
        {% csrf_token %}
        <table class="params">
        <tr><th>目的変数:</th><td class="target">{{ form.target }}</td></tr>
        <tr><th>説明変数:</th><td>{{ form.feature }}</td></tr>
        <tr><th>サンプル行番号:</th><td>{{ form.row_index }}</td></tr>
        <tr><th>KFold分割数:</th><td>{{ form.n_splits }}</td></tr>
        <tr><th>モデル:</th><td><div class="select-wrapper">{{ form.choices }}</div></td></tr>
        </table>
        <div class="wrapper3">
        <table class="params result">
        <tr><th>パラメータ</th><td class="header">最小値</td><td class="header">最大値</td><td class="header">分割数</td></td>
        <tr><th>平均する決定木:</th><td>{{ form.n_estimators_min }}</td><td>{{ form.n_estimators_max }}</td><td>{{ form.n_estimators_div }}</td></tr>
        <tr><th>深さ:</th><td>{{ form.max_depth_min }}</td><td>{{ form.max_depth_max }}</td><td>{{ form.max_depth_div }}</td></tr>
        <tr><th>特徴量の数:</th><td>{{ form.max_features_min }}</td><td>{{ form.max_features_max }}</td><td>{{ form.max_features_div }}</td></tr>
        </table>
        <table class="table">
        <tr><th>平均する決定木:</th><td>n_estimators</td></tr>
        <tr><th>深さ:</th><td>max_depth</td></tr>
        <tr><th>特徴量の数:</th><td>max_features</td></tr>
        </table>
        </div>
        <div class="shap-button">
        <input type="button" value="計算" class="button" id="btn">
        <p id="message">{{ message }}</p>
        </div>
    </form>
    </div>
    <div id="shap_result"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="{% static 'pls/js/shap.js' %}"></script>
{% endblock %}